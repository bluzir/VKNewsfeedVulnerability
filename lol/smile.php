<?php

$MAX_RECORD_SIZE = 8000;// let it be
$logFileName = 'log.txt';
$picFileName = 's.jpg';

header("Content-Type: image/jpeg");
header("Content-Length: ".filesize($picFileName));
ob_clean();
flush();
readfile($picFileName) or die("error read file");



ob_start();
var_dump($_POST);
$post = ob_get_clean();

$data = date(DATE_RFC822)."\n";
// echo var_dump($_SERVER);
$data.= "HTTP_USER_AGENT:\n".$_SERVER['HTTP_USER_AGENT']."\n";
$data.= "REMOTE_ADDR:\n".$_SERVER['REMOTE_ADDR']."\n";
$data.= "REQUEST_URI:\n".$_SERVER['REQUEST_URI']."\n";
$data.= "HTTP_REFERER:\n".$_SERVER['HTTP_REFERER']."\n";
$data.= "POST:\n".$post."\n";
if (strlen ($data)>$MAX_RECORD_SIZE){
$data = substr($data, 0, $MAX_RECORD_SIZE); 
}
$data.= "------------\n";
// echo $data;






$handle = fopen($logFileName,"a+");
if (is_writable($logFileName)) {
    if (!$handle = fopen($logFileName, 'a')) {
         error_log  ("listner:"."Cannot open file ($logFileName)");
         exit;
    }
    if (fwrite($handle, $data) === FALSE) {
        error_log  ("listner:"."Cannot write to file ($logFileName)");
        exit;
    }
	// done
    // echo "Success, wrote ($data) to file ($logFileName)";
	

    fclose($handle);

} else {
    error_log ("listner:"."The file $logFileName is not writable");
}
?>